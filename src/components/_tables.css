/**
 * Symphony CSS Framework v2.0
 * Tables - Semantic Table Styling
 * 
 * Philosophy:
 * - Semantic HTML tables with sensible defaults
 * - Responsive by default (horizontal scroll)
 * - Zero JavaScript required for basic features
 * - Data attributes for variants (striped, hoverable, bordered)
 * - Container query support for adaptive layouts
 * 
 * Usage:
 *   <table>
 *     <thead>
 *       <tr>
 *         <th>Name</th>
 *         <th>Email</th>
 *       </tr>
 *     </thead>
 *     <tbody>
 *       <tr>
 *         <td>John</td>
 *         <td>john@example.com</td>
 *       </tr>
 *     </tbody>
 *   </table>
 */

@layer symphony.components {
    /* =============================================
     TABLE WRAPPER (for responsive scrolling)
     ============================================= */

    .table-wrapper {
        container-type: inline-size;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;

        /* Scroll shadow indicators */
        background:
            linear-gradient(to right, var(--symphony-surface) 30%, transparent),
            linear-gradient(to left, var(--symphony-surface) 30%, transparent),
            linear-gradient(to right, var(--symphony-border) 0%, transparent 10%),
            linear-gradient(to left, var(--symphony-border) 0%, transparent 10%);
        background-position: left center, right center, left center, right center;
        background-size: 1rem 100%, 1rem 100%, 0.5rem 100%, 0.5rem 100%;
        background-repeat: no-repeat;
        background-attachment: local, local, scroll, scroll;
    }

    /* =============================================
     SEMANTIC TABLE BASE
     All <table> elements get sensible defaults
     ============================================= */

    :where(table) {
        width: 100%;
        border-collapse: collapse;
        text-align: start;
        font-variant-numeric: tabular-nums;
        caption-side: bottom;
    }

    :where(caption) {
        padding: var(--symphony-space-md);
        font-size: var(--symphony-text-sm);
        color: var(--symphony-text-muted);
        text-align: start;
    }

    :where(thead) {
        border-block-end: 2px solid var(--symphony-border);

        & th {
            font-weight: var(--symphony-font-semibold);
            color: var(--symphony-text-muted);
            font-size: var(--symphony-text-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    }

    :where(tbody) {
        & tr {
            border-block-end: 1px solid var(--symphony-border);

            &:last-child {
                border-block-end: none;
            }
        }
    }

    :where(tfoot) {
        border-block-start: 2px solid var(--symphony-border);
        font-weight: var(--symphony-font-medium);
    }

    :where(th),
    :where(td) {
        padding: var(--table-cell-padding, var(--symphony-space-md));
        text-align: start;
        vertical-align: top;
    }

    :where(th[scope="row"]) {
        font-weight: var(--symphony-font-medium);
    }

    /* =============================================
     TABLE VARIANTS (Data Attributes)
     ============================================= */

    /* Striped rows */
    :where(table[data-striped]) tbody tr:nth-child(odd),
    :where(.table-striped) tbody tr:nth-child(odd) {
        background-color: var(--symphony-surface-alt);
    }

    /* Striped columns */
    :where(table[data-striped="columns"]) {

        & th:nth-child(odd),
        & td:nth-child(odd) {
            background-color: var(--symphony-surface-alt);
        }

        & tbody tr:nth-child(odd) {
            background-color: transparent;
        }
    }

    /* Hoverable rows */
    :where(table[data-hoverable]) tbody tr,
    :where(.table-hoverable) tbody tr {
        transition: var(--symphony-transition-colors);

        &:hover {
            background-color: var(--symphony-surface-hover);
        }
    }

    /* Bordered table */
    :where(table[data-bordered]),
    :where(.table-bordered) {
        border: 1px solid var(--symphony-border);

        & th,
        & td {
            border: 1px solid var(--symphony-border);
        }
    }

    /* Borderless table */
    :where(table[data-borderless]),
    :where(.table-borderless) {

        & th,
        & td {
            border: none;
        }

        & thead {
            border-block-end: none;
        }

        & tbody tr {
            border-block-end: none;
        }
    }

    /* =============================================
     TABLE SIZES
     ============================================= */

    :where(table[data-size="compact"]),
    :where(.table-compact) {
        --table-cell-padding: var(--symphony-space-xs) var(--symphony-space-sm);
        font-size: var(--symphony-text-sm);
    }

    :where(table[data-size="comfortable"]),
    :where(.table-comfortable) {
        --table-cell-padding: var(--symphony-space-lg);
    }

    /* =============================================
     TABLE ALIGNMENT
     ============================================= */

    /* Numeric/right-aligned columns */
    :where(td[data-align="end"]),
    :where(th[data-align="end"]),
    :where(.text-end) {
        text-align: end;
    }

    :where(td[data-align="center"]),
    :where(th[data-align="center"]),
    :where(.text-center) {
        text-align: center;
    }

    /* Vertical alignment */
    :where(td[data-valign="middle"]),
    :where(th[data-valign="middle"]) {
        vertical-align: middle;
    }

    :where(td[data-valign="bottom"]),
    :where(th[data-valign="bottom"]) {
        vertical-align: bottom;
    }

    /* =============================================
     SORTABLE TABLE HEADERS
     ============================================= */

    :where(th[data-sortable]),
    :where(.sortable) {
        cursor: pointer;
        user-select: none;

        &:hover {
            background-color: var(--symphony-surface-hover);
        }

        &::after {
            content: '';
            display: inline-block;
            margin-inline-start: var(--symphony-space-xs);
            inline-size: 1em;
            block-size: 1em;
            vertical-align: middle;
            background-color: currentColor;
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M7 15l5 5 5-5M7 9l5-5 5 5'/%3E%3C/svg%3E");
            mask-size: contain;
            mask-repeat: no-repeat;
            opacity: 0.3;
            transition: opacity var(--symphony-duration-fast);
        }

        &:hover::after {
            opacity: 0.6;
        }

        &[aria-sort="ascending"]::after {
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M7 15l5 5 5-5'/%3E%3C/svg%3E");
            opacity: 1;
        }

        &[aria-sort="descending"]::after {
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'%3E%3Cpath d='M7 9l5-5 5 5'/%3E%3C/svg%3E");
            opacity: 1;
        }
    }

    /* =============================================
     STICKY HEADERS/COLUMNS
     ============================================= */

    :where(thead[data-sticky]),
    :where(.thead-sticky) {
        & th {
            position: sticky;
            inset-block-start: 0;
            z-index: 1;
            background-color: var(--symphony-surface);
        }
    }

    :where(th[data-sticky]),
    :where(td[data-sticky]),
    :where(.col-sticky) {
        position: sticky;
        inset-inline-start: 0;
        z-index: 1;
        background-color: var(--symphony-surface);
    }

    /* =============================================
     ROW/CELL STATES
     ============================================= */

    :where(tr[data-state="selected"]),
    :where(tr.selected) {
        background-color: oklch(from var(--symphony-primary) l c h / 0.1);

        &:hover {
            background-color: oklch(from var(--symphony-primary) l c h / 0.15);
        }
    }

    :where(tr[data-state="success"]),
    :where(tr.success) {
        background-color: oklch(from var(--symphony-success) l c h / 0.1);
    }

    :where(tr[data-state="warning"]),
    :where(tr.warning) {
        background-color: oklch(from var(--symphony-warning) l c h / 0.1);
    }

    :where(tr[data-state="danger"]),
    :where(tr.danger) {
        background-color: oklch(from var(--symphony-danger) l c h / 0.1);
    }

    /* =============================================
     RESPONSIVE TABLE (stacked on small screens)
     ============================================= */

    @container (max-width: 600px) {
        :where(table[data-responsive="stack"]) {
            & thead {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            & tr {
                display: block;
                margin-block-end: var(--symphony-space-md);
                border: 1px solid var(--symphony-border);
                border-radius: var(--symphony-radius-md);
            }

            & td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                text-align: end;
                border: none;
                border-block-end: 1px solid var(--symphony-border);

                &:last-child {
                    border-block-end: none;
                }

                &::before {
                    content: attr(data-label);
                    font-weight: var(--symphony-font-semibold);
                    text-align: start;
                    color: var(--symphony-text-muted);
                }
            }
        }
    }

    /* =============================================
     DATA GRID / FIXED LAYOUT
     ============================================= */

    :where(table[data-layout="fixed"]),
    :where(.table-fixed) {
        table-layout: fixed;
    }

    /* =============================================
     PRINT STYLES
     ============================================= */

    @media print {
        :where(table) {
            border-collapse: collapse;

            & th,
            & td {
                border: 1px solid #000;
                padding: 0.25rem;
            }

            & thead {
                display: table-header-group;

                & th {
                    background-color: rgba(240, 240, 240, 0.3) !important;
                    color: #000;
                }
            }

            & tr {
                page-break-inside: avoid;
            }
        }
    }
}