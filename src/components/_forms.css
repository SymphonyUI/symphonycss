/**
 * Symphony CSS Framework v2.0
 * Forms - Semantic Form Element Styling
 * 
 * Philosophy:
 * - Semantic HTML form elements with sensible defaults
 * - Zero classes needed for basic form styling
 * - Data attributes for variants and states
 * - Native form validation styling
 * - Accessible by default (proper focus states, ARIA support)
 * 
 * Usage:
 *   <form>
 *     <label>
 *       Email
 *       <input type="email" required>
 *     </label>
 *     <label>
 *       Message
 *       <textarea></textarea>
 *     </label>
 *     <button type="submit">Send</button>
 *   </form>
 */

@layer symphony.components {
  /* =============================================
     INPUT BASE STYLES
     All text inputs styled by default
     ============================================= */

  :where(input:not([type="checkbox"]):not([type="radio"]):not([type="range"]):not([type="file"]):not([type="color"]):not([type="button"]):not([type="submit"]):not([type="reset"]):not([type="image"])) {
    display: block;
    inline-size: 100%;
    padding: var(--input-padding, var(--symphony-space-sm) var(--symphony-space-md));
    font-family: inherit;
    font-size: var(--symphony-text-base);
    line-height: var(--symphony-leading-normal);
    color: var(--symphony-text);
    background-color: var(--symphony-surface);
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-md);
    transition: var(--symphony-transition-colors), box-shadow var(--symphony-duration-fast);

    &:hover:not(:disabled):not(:focus) {
      border-color: var(--symphony-border-hover);
    }

    &:focus {
      outline: none;
      border-color: var(--symphony-primary);
      box-shadow: var(--symphony-focus-ring);
    }

    &::placeholder {
      color: var(--symphony-text-muted);
      opacity: 0.7;
    }

    &:disabled {
      background-color: var(--symphony-surface-alt);
      color: var(--symphony-text-muted);
      cursor: not-allowed;
      opacity: 0.7;
    }

    &:read-only {
      background-color: var(--symphony-surface-alt);
    }
  }

  /* =============================================
     INPUT SIZES
     ============================================= */

  :where(input[data-size="sm"]) {
    --input-padding: var(--symphony-space-xs) var(--symphony-space-sm);
    font-size: var(--symphony-text-sm);
  }

  :where(input[data-size="lg"]) {
    --input-padding: var(--symphony-space-md) var(--symphony-space-lg);
    font-size: var(--symphony-text-lg);
  }

  /* =============================================
     VALIDATION STATES
     Native HTML5 validation + data-state
     ============================================= */

  /* Invalid state */
  :where(input:user-invalid),
  :where(input[data-state="error"]),
  :where(input[aria-invalid="true"]) {
    border-color: var(--symphony-danger);

    &:focus {
      border-color: var(--symphony-danger);
      box-shadow: 0 0 0 3px oklch(from var(--symphony-danger) l c h / 0.15);
    }
  }

  /* Valid state */
  :where(input:user-valid:not(:placeholder-shown)),
  :where(input[data-state="success"]) {
    border-color: var(--symphony-success);

    &:focus {
      border-color: var(--symphony-success);
      box-shadow: 0 0 0 3px oklch(from var(--symphony-success) l c h / 0.15);
    }
  }

  /* =============================================
     TEXTAREA
     ============================================= */

  :where(textarea) {
    display: block;
    inline-size: 100%;
    min-block-size: 6rem;
    padding: var(--symphony-space-sm) var(--symphony-space-md);
    font-family: inherit;
    font-size: var(--symphony-text-base);
    line-height: var(--symphony-leading-relaxed);
    color: var(--symphony-text);
    background-color: var(--symphony-surface);
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-md);
    resize: vertical;
    transition: var(--symphony-transition-colors), box-shadow var(--symphony-duration-fast);

    &:hover:not(:disabled):not(:focus) {
      border-color: var(--symphony-border-hover);
    }

    &:focus {
      outline: none;
      border-color: var(--symphony-primary);
      box-shadow: var(--symphony-focus-ring);
    }

    &::placeholder {
      color: var(--symphony-text-muted);
      opacity: 0.7;
    }

    &:disabled {
      background-color: var(--symphony-surface-alt);
      cursor: not-allowed;
      opacity: 0.7;
    }
  }

  :where(textarea[data-resize="none"]) {
    resize: none;
  }

  :where(textarea[data-resize="horizontal"]) {
    resize: horizontal;
  }

  :where(textarea[data-resize="both"]) {
    resize: both;
  }

  /* =============================================
     SELECT
     ============================================= */

  :where(select) {
    display: block;
    inline-size: 100%;
    padding: var(--symphony-space-sm) var(--symphony-space-md);
    padding-inline-end: var(--symphony-space-2xl);
    font-family: inherit;
    font-size: var(--symphony-text-base);
    line-height: var(--symphony-leading-normal);
    color: var(--symphony-text);
    background-color: var(--symphony-surface);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right var(--symphony-space-sm) center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-md);
    transition: var(--symphony-transition-colors), box-shadow var(--symphony-duration-fast);
    cursor: pointer;
    appearance: none;

    &:hover:not(:disabled) {
      border-color: var(--symphony-border-hover);
    }

    &:focus {
      outline: none;
      border-color: var(--symphony-primary);
      box-shadow: var(--symphony-focus-ring);
    }

    &:disabled {
      background-color: var(--symphony-surface-alt);
      cursor: not-allowed;
      opacity: 0.7;
    }

    &[multiple] {
      padding-inline-end: var(--symphony-space-md);
      background-image: none;
      block-size: auto;
    }
  }

  /* =============================================
     CHECKBOX
     ============================================= */

  :where(input[type="checkbox"]) {
    inline-size: 1.125rem;
    block-size: 1.125rem;
    accent-color: var(--symphony-primary);
    cursor: pointer;

    &:focus-visible {
      outline: none;
      box-shadow: var(--symphony-focus-ring);
      border-radius: var(--symphony-radius-sm);
    }

    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
  }

  /* Custom checkbox styling */
  :where(input[type="checkbox"][data-custom]) {
    appearance: none;
    background-color: var(--symphony-surface);
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-sm);
    transition: var(--symphony-transition-colors);
    position: relative;

    &:hover:not(:disabled) {
      border-color: var(--symphony-border-hover);
    }

    &:checked {
      background-color: var(--symphony-primary);
      border-color: var(--symphony-primary);

      &::after {
        content: '';
        position: absolute;
        inset: 0;
        background-color: white;
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='3'%3E%3Cpath d='M5 12l5 5L20 7'/%3E%3C/svg%3E");
        mask-size: 75%;
        mask-position: center;
        mask-repeat: no-repeat;
      }
    }

    &:indeterminate {
      background-color: var(--symphony-primary);
      border-color: var(--symphony-primary);

      &::after {
        content: '';
        position: absolute;
        inset: 0;
        background-color: white;
        mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='3'%3E%3Cpath d='M5 12h14'/%3E%3C/svg%3E");
        mask-size: 60%;
        mask-position: center;
        mask-repeat: no-repeat;
      }
    }
  }

  /* =============================================
     RADIO
     ============================================= */

  :where(input[type="radio"]) {
    inline-size: 1.125rem;
    block-size: 1.125rem;
    accent-color: var(--symphony-primary);
    cursor: pointer;

    &:focus-visible {
      outline: none;
      box-shadow: var(--symphony-focus-ring);
      border-radius: var(--symphony-radius-full);
    }

    &:disabled {
      cursor: not-allowed;
      opacity: 0.5;
    }
  }

  /* Custom radio styling */
  :where(input[type="radio"][data-custom]) {
    appearance: none;
    background-color: var(--symphony-surface);
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-full);
    transition: var(--symphony-transition-colors);
    position: relative;

    &:hover:not(:disabled) {
      border-color: var(--symphony-border-hover);
    }

    &:checked {
      border-color: var(--symphony-primary);

      &::after {
        content: '';
        position: absolute;
        inset: 3px;
        background-color: var(--symphony-primary);
        border-radius: var(--symphony-radius-full);
      }
    }
  }

  /* =============================================
     RANGE SLIDER
     ============================================= */

  :where(input[type="range"]) {
    inline-size: 100%;
    block-size: 0.5rem;
    accent-color: var(--symphony-primary);
    cursor: pointer;

    &:focus-visible {
      outline: none;
    }
  }

  /* =============================================
     COLOR PICKER
     ============================================= */

  :where(input[type="color"]) {
    inline-size: 3rem;
    block-size: 2.5rem;
    padding: var(--symphony-space-xs);
    border: 1px solid var(--symphony-border);
    border-radius: var(--symphony-radius-md);
    cursor: pointer;

    &::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    &::-webkit-color-swatch {
      border: none;
      border-radius: var(--symphony-radius-sm);
    }
  }

  /* =============================================
     FILE INPUT
     ============================================= */

  :where(input[type="file"]) {
    display: block;
    inline-size: 100%;
    font-size: var(--symphony-text-sm);
    color: var(--symphony-text-muted);

    &::file-selector-button {
      padding: var(--symphony-space-sm) var(--symphony-space-md);
      margin-inline-end: var(--symphony-space-md);
      font-weight: var(--symphony-font-medium);
      color: var(--symphony-text);
      background-color: var(--symphony-surface-alt);
      border: 1px solid var(--symphony-border);
      border-radius: var(--symphony-radius-md);
      cursor: pointer;
      transition: var(--symphony-transition-colors);

      &:hover {
        background-color: var(--symphony-surface-hover);
      }
    }

    &:focus-visible {
      outline: none;

      &::file-selector-button {
        box-shadow: var(--symphony-focus-ring);
      }
    }
  }

  /* =============================================
     SWITCH / TOGGLE
     Native checkbox as switch
     ============================================= */

  :where(input[type="checkbox"][role="switch"]),
  :where(input[type="checkbox"][data-switch]) {
    appearance: none;
    inline-size: 2.5rem;
    block-size: 1.375rem;
    background-color: var(--symphony-border);
    border: none;
    border-radius: var(--symphony-radius-full);
    cursor: pointer;
    transition: background-color var(--symphony-duration-fast) var(--symphony-ease-out);
    position: relative;

    &::before {
      content: '';
      position: absolute;
      inset-block: 2px;
      inset-inline-start: 2px;
      inline-size: calc(1.375rem - 4px);
      block-size: calc(1.375rem - 4px);
      background-color: white;
      border-radius: var(--symphony-radius-full);
      transition: transform var(--symphony-duration-fast) var(--symphony-ease-out);
      box-shadow: var(--symphony-shadow-sm);
    }

    &:checked {
      background-color: var(--symphony-primary);

      &::before {
        transform: translateX(calc(2.5rem - 1.375rem));
      }
    }

    &:focus-visible {
      outline: none;
      box-shadow: var(--symphony-focus-ring);
    }

    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  }

  /* =============================================
     FORM GROUP
     Label + input + help/error wrapper
     ============================================= */

  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--symphony-space-xs);
    margin-block-end: var(--symphony-space-md);

    &>label {
      font-weight: var(--symphony-font-medium);
      margin-block-end: 0;
    }
  }

  /* =============================================
     FORM HELP & ERROR TEXT
     ============================================= */

  .form-help,
  [data-form-help] {
    font-size: var(--symphony-text-sm);
    color: var(--symphony-text-muted);
    margin-block-start: var(--symphony-space-xs);
  }

  .form-error,
  [data-form-error] {
    font-size: var(--symphony-text-sm);
    color: var(--symphony-danger);
    margin-block-start: var(--symphony-space-xs);
  }

  .form-success,
  [data-form-success] {
    font-size: var(--symphony-text-sm);
    color: var(--symphony-success);
    margin-block-start: var(--symphony-space-xs);
  }

  /* =============================================
     INPUT GROUP (addon + input)
     ============================================= */

  .input-group {
    display: flex;

    &>input {
      flex: 1;
      min-inline-size: 0;
      border-radius: 0;

      &:first-child {
        border-start-start-radius: var(--symphony-radius-md);
        border-end-start-radius: var(--symphony-radius-md);
      }

      &:last-child {
        border-start-end-radius: var(--symphony-radius-md);
        border-end-end-radius: var(--symphony-radius-md);
      }
    }
  }

  .input-addon {
    display: flex;
    align-items: center;
    padding-inline: var(--symphony-space-md);
    background-color: var(--symphony-surface-alt);
    border: 1px solid var(--symphony-border);
    color: var(--symphony-text-muted);
    white-space: nowrap;

    &:first-child {
      border-start-start-radius: var(--symphony-radius-md);
      border-end-start-radius: var(--symphony-radius-md);
      border-inline-end: none;
    }

    &:last-child {
      border-start-end-radius: var(--symphony-radius-md);
      border-end-end-radius: var(--symphony-radius-md);
      border-inline-start: none;
    }
  }

  /* =============================================
     INLINE FORM CONTROLS
     ============================================= */

  .form-inline {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--symphony-space-md);

    &>* {
      margin-block-end: 0;
    }
  }

  /* =============================================
     CHECKBOX/RADIO GROUP
     ============================================= */

  .checkbox-group,
  .radio-group {
    display: flex;
    flex-direction: column;
    gap: var(--symphony-space-sm);

    &>label {
      display: flex;
      align-items: center;
      gap: var(--symphony-space-sm);
      font-weight: var(--symphony-font-normal);
      cursor: pointer;

      &>input {
        flex-shrink: 0;
      }
    }
  }

  .checkbox-group[data-direction="row"],
  .radio-group[data-direction="row"] {
    flex-direction: row;
    flex-wrap: wrap;
    gap: var(--symphony-space-md);
  }

  /* =============================================
     FLOATING LABELS
     ============================================= */

  .form-floating {
    position: relative;

    &>input,
    &>textarea,
    &>select {
      padding-block-start: var(--symphony-space-lg);

      &:focus~label,
      &:not(:placeholder-shown)~label {
        transform: translateY(-50%) scale(0.85);
        color: var(--symphony-primary);
      }
    }

    &>label {
      position: absolute;
      inset-block-start: 50%;
      inset-inline-start: var(--symphony-space-md);
      transform: translateY(-50%);
      color: var(--symphony-text-muted);
      pointer-events: none;
      transition: transform var(--symphony-duration-fast), color var(--symphony-duration-fast);
      transform-origin: left top;
    }

    &>textarea~label {
      inset-block-start: var(--symphony-space-md);
      transform: none;
    }

    &>textarea:focus~label,
    &>textarea:not(:placeholder-shown)~label {
      transform: translateY(-100%) scale(0.85);
    }
  }

  /* =============================================
     PRINT STYLES
     ============================================= */

  @media print {
    :where(input, textarea, select) {
      border: 1px solid #000;
      background: white;
    }

    :where(input[type="checkbox"]),
    :where(input[type="radio"]) {
      border: 1px solid #000;
    }
  }
}